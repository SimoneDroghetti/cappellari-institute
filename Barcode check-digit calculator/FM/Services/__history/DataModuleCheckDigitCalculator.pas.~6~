unit DataModuleCheckDigitCalculator;

interface

uses
  System.SysUtils, System.Classes, Data.DB, Data.Win.ADODB;

type
    TDataModuleCheckDigitCalculator = class(TDataModule)
      private
          ConnectionCD: TADOConnection;
          QueryFunctionCheckDigit: TADOQuery;
          const QueryFunctionCheckDigitEnd: string = ');';
      public
          procedure ConnectToAdventureWorks();
          procedure SetSQL(AIncompleteBarcode: string);
          function GetCheckDigitFromQuery: integer;
end;

implementation

{ TDataModuleCheckDigitCalculator }

procedure TDataModuleCheckDigitCalculator.ConnectToAdventureWorks;
begin
    ConnectionCD.ConnectionString:=
      'Provider=SQLOLEDB.1;Password=94483ycWSmrC22893etWS995!5k88X;Pers' +
      'ist Security Info=True;User ID=CorsoDelphiSQL;Initial Catalog=Ad' +
      'ventureWorks;Data Source=corso-cappellari.database.windows.net';
    ConnectionCD.Connected = True;
    ConnectionCD.LoginPrompt = False;
    ConnectionCD.Provider = 'SQLOLEDB.1';
    QueryFunctionCheckDigit.Connection:=ConnectionCD;

end;






procedure TDataModuleCheckDigitCalculator.SetSQL(AIncompleteBarcode: string);
begin
    //Parameters = <>
    QueryFunctionCheckDigit.SQL.Strings = (
      'SELECT dbo.FM_CalculateCheckDigit('+AIncompleteBarcode+');');
    QueryFunctionCheckDigit.Open;
end;


function TDataModuleCheckDigitCalculator.GetCheckDigitFromQuery: integer;
begin
    QueryFunctionCheckDigit.First;
    Result:=QueryFunctionCheckDigit.Fields[0].AsInteger;
end;

end.
